<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Katraka Lanches â€” CardÃ¡pio</title>
  <style>
    :root{
      --bg:#0f1724; --accent:#ffcc00; --muted:#9aa4b2; --card:#0b1220; --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#091026 0%, #07101b 100%);color:#e6eef6;-webkit-font-smoothing:antialiased}
    header{position:sticky;top:0;z-index:1000;background:rgba(15,23,36,0.96);backdrop-filter:blur(6px);display:flex;align-items:center;gap:14px;padding:10px 16px;border-bottom:1px solid rgba(255,255,255,0.04)}
    .logo img{width:64px;height:64px;border-radius:10px;object-fit:cover}
    .brand h1{margin:0;color:var(--accent);font-size:20px}
    .brand p{margin:0;color:var(--muted);font-size:13px}
    .container{max-width:1200px;margin:14px auto;padding:16px}
    .cats{position:sticky;top:78px;z-index:900;display:flex;gap:8px;flex-wrap:wrap;background:transparent;padding:8px 0;margin-bottom:12px;border-bottom:1px solid rgba(255,255,255,0.02)}
    .cat{padding:8px 14px;border-radius:999px;background:rgba(255,255,255,0.02);color:var(--muted);cursor:pointer;font-size:13px;border:1px solid rgba(255,255,255,0.02)}
    .cat.active{background:linear-gradient(90deg,var(--accent),#ffb400);color:#081018;font-weight:700}
    .search{margin:10px 0}
    .search input{width:100%;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.04);color:white}
    .layout{display:grid;grid-template-columns:1fr 360px;gap:20px}
    .menu{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:12px;border-radius:var(--radius);box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .items{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
    .card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;display:flex;gap:12px;align-items:center;border:1px solid rgba(255,255,255,0.03)}
    .thumb{width:80px;height:80px;border-radius:8px;background:linear-gradient(180deg,#111,#222);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:14px}
    .info h3{margin:0;font-size:15px;color:#fff}
    .info p{margin:6px 0 0;font-size:13px;color:var(--muted)}
    .actions{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:8px}
    .price{font-weight:800;color:var(--accent)}
    .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:#081018;cursor:pointer;font-weight:800}
    aside.cart{position:sticky;top:24px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);height:fit-content}
    .cart h2{margin:0 0 8px;font-size:18px;color:var(--accent)}
    .cart-list{display:flex;flex-direction:column;gap:8px;max-height:300px;overflow:auto;padding-right:6px; margin-bottom: 12px;}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.01)}
    .qty{display:inline-flex;gap:6px;align-items:center}
    .qty button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);border-radius:6px;padding:4px 8px;cursor:pointer}
    .total{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-weight:800}
    .wa-btn{display:block;text-align:center;margin-top:12px;padding:10px;border-radius:10px;text-decoration:none;font-weight:800;background:linear-gradient(90deg,#25D366,#128C7E);color:white;cursor:pointer;}

    /* ESTILOS DO FORMULÃRIO DE CHECKOUT */
    .checkout-form label { display: block; margin-top: 10px; font-size: 13px; color: var(--muted); }
    .checkout-form input:not([type="radio"]), .checkout-form select {
        width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.1);
        background: rgba(255,255,255,0.04); color: white; font-size: 14px;
    }
    .checkout-form select { 
        height: 38px; 
        background: rgba(255,255,255,0.08);
        color: #fff;
    }
    .checkout-form select option {
        background-color: var(--card);
        color: #fff;
    }
    .checkout-form .form-row { display: flex; gap: 10px; }
    .checkout-form .form-row > div { flex: 1; }
    .checkout-form h3 { margin: 15px 0 5px; font-size: 16px; color: #fff; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px;}
    .checkout-form .radio-group label { display: inline-block; margin-right: 15px; margin-top: 5px; color: #fff; }
    .troco-field { display: none; margin-top: 10px;}
    .required::after { content: " *"; color: var(--accent); }

    @media (max-width:960px){.layout{grid-template-columns:1fr}.cats{position:relative;top:0}}
  </style>
</head>
<body>
  <header>
    <div class="logo"><img src="1000125797-removebg-preview.png" alt="Katraka Lanches"></div>
    <div class="brand">
      <h1>Katraka Lanches</h1>
      <p>SanduÃ­ches â€¢ PorÃ§Ãµes â€¢ Bebidas â€” PeÃ§a pelo WhatsApp</p>
    </div>
  </header>

  <div class="container">
    <div class="cats" id="cats"></div>

    <div class="search"><input id="search" placeholder="ðŸ” Procurar no cardÃ¡pio..." oninput="render()"></div>

    <div class="layout">
      <main class="menu">
        <div class="items" id="items"></div>
      </main>

      <aside class="cart">
        <h2>ðŸ›’ Seu pedido</h2>
        <div class="cart-list" id="cartList"><div style="color:var(--muted)">Carrinho vazio â€” adicione algo gostoso!</div></div>
        <div class="total"><div>Total</div><div id="totalPrice">R$ 0,00</div></div>

        <form id="checkoutForm" class="checkout-form" onsubmit="event.preventDefault(); validateAndSendToWhatsApp();">
            <h3>Dados para Entrega</h3>
            <label for="clientName" class="required">Seu Nome</label>
            <input type="text" id="clientName" required placeholder="Ex: JoÃ£o da Silva">

            <div class="form-row">
                <div>
                    <label for="clientAddress" class="required">Rua/Avenida</label>
                    <input type="text" id="clientAddress" required placeholder="Ex: Rua das Flores">
                </div>
                <div>
                    <label for="clientNumber" class="required">NÃºmero</label>
                    <input type="text" id="clientNumber" required placeholder="Ex: 123">
                </div>
            </div>

            <div class="form-row">
                <div>
                    <label for="clientCEP" class="required">CEP</label>
                    <input type="text" id="clientCEP" required placeholder="Ex: 13000-000">
                </div>
                <div>
                    <label for="clientPhone" class="required">Telefone</label>
                    <input type="tel" id="clientPhone" required placeholder="Ex: (19) 99999-9999">
                </div>
            </div>

            <label for="clientRef">Ponto de ReferÃªncia (Opcional)</label>
            <input type="text" id="clientRef" placeholder="Ex: Ao lado da farmÃ¡cia">

            <h3>Pagamento</h3>
            <label for="paymentMethod" class="required">Forma de Pagamento</label>
            <select id="paymentMethod" required onchange="toggleTroco()">
                <option value="">Selecione...</option>
                <option value="Dinheiro">Dinheiro</option>
                <option value="PIX">PIX</option>
                <option value="CartÃ£o">CartÃ£o (CrÃ©dito/DÃ©bito)</option>
            </select>

            <div id="trocoField" class="troco-field">
                <label for="trocoPara" class="required">Troco para quanto?</label>
                <input type="number" step="0.01" id="trocoPara" placeholder="Ex: 50.00">
            </div>
            
            <div style="font-size:12px;color:var(--muted);margin-top:8px">WhatsApp: <strong>(19) 99423-3412</strong></div>
            <button type="submit" id="whatsBtn" class="wa-btn">Finalizar no WhatsApp</button>
        </form>
      </aside>
    </div>

    <footer>Â© <span id="year"></span> Katraka Lanches â€” feito com â™¥ï¸Ž</footer>
  </div>

  <script>
    // NÃºmero do WhatsApp (configurado)
    const PHONE_NUMBER = '5519994233412';

    // FUNÃ‡ÃƒO PARA OBTER E PERSISTIR O ID DO PEDIDO
    const getNextOrderID = () => {
        let id = localStorage.getItem('katraka_order_id');
        if (!id) {
            id = 1000; // ComeÃ§a em 1000 se nÃ£o houver um ID salvo
        } else {
            id = parseInt(id);
        }
        
        // Salva o prÃ³ximo ID para ser usado na prÃ³xima sessÃ£o/pedido
        localStorage.setItem('katraka_order_id', id + 1);
        return id;
    };

    // Menu completo (extraÃ­do do arquivo 2.txt)
    const MENU = [
      // HambÃºrgueres (101-108, X-Tudo, Especial, Animal)
      {cat:'HambÃºrguer',code:'101',name:'HambÃºrguer e queijo',desc:'HambÃºrguer e queijo',price:22.00},
      {cat:'HambÃºrguer',code:'102',name:'HambÃºrguer, queijo e salada',desc:'HambÃºrguer, queijo e salada',price:23.00},
      {cat:'HambÃºrguer',code:'103',name:'HambÃºrguer, queijo, vinagrete e salada',desc:'HambÃºrguer, queijo, vinagrete e salada',price:26.00},
      {cat:'HambÃºrguer',code:'104',name:'HambÃºrguer, queijo, bacon e salada',desc:'HambÃºrguer, queijo, bacon e salada',price:29.50},
      {cat:'HambÃºrguer',code:'105',name:'HambÃºrguer, queijo, presunto, champignon, bacon, ovo e salada',desc:'HambÃºrguer completo',price:38.00},
      {cat:'HambÃºrguer',code:'106',name:'HambÃºrguer, queijo, presunto, bacon, ovo e salada',desc:'HambÃºrguer completo',price:35.50},
      {cat:'HambÃºrguer',code:'107',name:'HambÃºrguer, queijo, presunto, milho, catupiry e salada',desc:'HambÃºrguer completo',price:39.50},
      {cat:'HambÃºrguer',code:'108',name:'HambÃºrguer, queijo, presunto, ovo, cebola e salada',desc:'HambÃºrguer completo',price:33.00},
      {cat:'HambÃºrguer',code:'X-Tudo',name:'X-Tudo',desc:'HambÃºrguer, queijo, presunto, ovo, catupiry, azeitona preta, bacon, calabresa e salada',price:47.50},
      {cat:'HambÃºrguer',code:'Especial de HambÃºrguer',name:'Especial de HambÃºrguer',desc:'2 hambÃºrgueres, queijo, presunto, ovo, catupiry, azeitona preta, bacon, calabresa e salada',price:49.50},
      {cat:'HambÃºrguer',code:'Animal',name:'Animal',desc:'3 hambÃºrgueres, queijo, presunto, bacon, 2 ovos, salada e calabresa',price:54.00},

      // Lanche de Calabresa (117-121)
      {cat:'Calabresa',code:'117',name:'Calabresa, queijo e salada',price:28.50},
      {cat:'Calabresa',code:'118',name:'Calabresa e cebola',price:28.50},
      {cat:'Calabresa',code:'119',name:'Calabresa, presunto, milho, catupiry e salada',price:39.50},
      {cat:'Calabresa',code:'120',name:'Calabresa, queijo, vinagrete, azeitona preta e salada',price:37.50},
      {cat:'Calabresa',code:'121',name:'Calabresa, mussarela, ovo e salada',price:36.00},

      // Lanche no PÃ£o FrancÃªs (143-145)
      {cat:'PÃ£o FrancÃªs',code:'143',name:'Misto (queijo e presunto)',price:19.50},
      {cat:'PÃ£o FrancÃªs',code:'144',name:'Americano (queijo, presunto, ovo e salada)',price:25.00},
      {cat:'PÃ£o FrancÃªs',code:'145',name:'Queijo, presunto, ovo, bacon e tomate',price:27.50},

      // Vegetariano (208-209)
      {cat:'Vegetariano',code:'208',name:'Vegetariano Simples',desc:'Cebola roxa, cebola branca, alface, tomate, milho e champignon',price:33.00},
      {cat:'Vegetariano',code:'209',name:'Vegetariano Completo',desc:'Cebola roxa, branca, alface, tomate, milho, champignon, vinagrete, azeitona, queijos e catupiry',price:40.00},

      // Lanche Gourmet (200-203)
      {cat:'Gourmet',code:'200',name:'Burger gourmet, queijo prato e molho',price:32.50},
      {cat:'Gourmet',code:'201',name:'Burger gourmet, queijo prato, alface, tomate, cebola roxa e molho',price:35.50},
      {cat:'Gourmet',code:'202',name:'Burger gourmet, queijo prato, bacon, alface, tomate, cebola roxa e molho',price:39.50},
      {cat:'Gourmet',code:'203',name:'2 burger gourmet, queijo prato, bacon e molho',price:44.50},

      // Adicionais
      {cat:'Adicionais',name:'Cebola',price:6.00},
      {cat:'Adicionais',name:'Salada',price:6.00},
      {cat:'Adicionais',name:'Catupiry',price:11.00},
      {cat:'Adicionais',name:'Bacon',price:9.00},
      {cat:'Adicionais',name:'Champignon',price:9.00},
      {cat:'Adicionais',name:'Presunto',price:7.00},
      {cat:'Adicionais',name:'Queijo',price:7.00},
      {cat:'Adicionais',name:'PÃ£o FrancÃªs',price:5.00},
      {cat:'Adicionais',name:'Cheddar',price:10.00},
      {cat:'Adicionais',name:'Frango',price:13.00},
      {cat:'Adicionais',name:'Milho',price:5.00},
      {cat:'Adicionais',name:'Ovo',price:3.50},
      {cat:'Adicionais',name:'FilÃ© Mignon (adicional)',price:16.00},
      {cat:'Adicionais',name:'HambÃºrguer (adicional)',price:8.00},
      {cat:'Adicionais',name:'Vinagrete',price:5.00},
      {cat:'Adicionais',name:'Calabresa (adicional)',price:9.00},
      {cat:'Adicionais',name:'Azeitona',price:10.00},
      {cat:'Adicionais',name:'LinguiÃ§a',price:14.00},
      {cat:'Adicionais',name:'Pernil (adicional)',price:14.00},

      // Rechaud (006-009)
      {cat:'Rechaud',code:'006',name:'Rechaud 006',desc:'Calabresa, contra filÃ© acebolado, batata, mandioca, vinagrete e pimenta biquinho',price:113.00},
      {cat:'Rechaud',code:'007',name:'Rechaud 007',desc:'FilÃ© de frango, calabresa acebolada, batata, mandioca, vinagrete e pimenta biquinho',price:113.00},
      {cat:'Rechaud',code:'008',name:'Rechaud 008',desc:'Contra filÃ© acebolado, frango a passarinho, batata, mandioca, vinagrete e pimenta biquinho',price:113.00},
      {cat:'Rechaud',code:'009',name:'Rechaud 009',desc:'Frango a passarinho, linguiÃ§a de BraganÃ§a, batata, mandioca, vinagrete e pimenta biquinho',price:113.00},

      // Boca de Anjo (001-005)
      {cat:'Boca de Anjo',code:'001',name:'Boca de Anjo 001',desc:'HambÃºrguer, queijo, presunto, ovo, milho, catupiry, salada e fritas',price:61.00},
      {cat:'Boca de Anjo',code:'002',name:'Boca de Anjo 002',desc:'Frango, queijo, presunto, ovo, bacon, azeitona preta, catupiry, salada e fritas',price:63.00},
      {cat:'Boca de Anjo',code:'003',name:'Boca de Anjo 003',desc:'Mignon, queijo, presunto, ovo, bacon, champignon, catupiry, salada e fritas',price:65.00},
      {cat:'Boca de Anjo',code:'004',name:'Boca de Anjo 004',desc:'Contra filÃ©, queijo, presunto, ovo, bacon, cebola, catupiry, salada e fritas',price:64.00},
      {cat:'Boca de Anjo',code:'005',name:'Boca de Anjo 005',desc:'LinguiÃ§a, queijo, presunto, ovo, bacon, vinagrete, catupiry, salada e fritas',price:61.00},

      // Bebidas (algumas sem preÃ§o na fonte mantidas com 0 para revisÃ£o)
      {cat:'Bebidas',code:'238',name:'Cerveja lata',price:0.00},
      {cat:'Bebidas',code:'239',name:'Cerveja 600ml',price:0.00},
      {cat:'Bebidas',code:'240',name:'Refrigerante lata 350ml',price:6.50},
      {cat:'Bebidas',code:'241',name:'Refrigerante 600ml',price:0.00},
      {cat:'Bebidas',code:'242',name:'Ãgua sem gÃ¡s 510ml',price:0.00},
      {cat:'Bebidas',code:'243',name:'Ãgua com gÃ¡s 510ml',price:0.00},
      {cat:'Bebidas',code:'281',name:'Heineken 600ml',price:0.00},
      {cat:'Bebidas',code:'282',name:'Brahma 600ml',price:0.00},
      {cat:'Bebidas',code:'283',name:'ImpÃ©rio 600ml',price:0.00},
      {cat:'Bebidas',code:'284',name:'Original 600ml',price:0.00},

      // COCA-COLA KS (sem preÃ§o especificado)
      {cat:'Bebidas',name:'Coca-Cola KS',price:0.00},

      // Sucos (227-237)
      {cat:'Sucos',code:'227',name:'AÃ§aÃ­ (polpa)',price:16.00},
      {cat:'Sucos',code:'228',name:'Laranja (natural)',price:16.00},
      {cat:'Sucos',code:'232',name:'Caju (polpa)',price:16.00},
      {cat:'Sucos',code:'234',name:'MaracujÃ¡ (polpa)',price:16.00},
      {cat:'Sucos',code:'235',name:'Acerola (polpa)',price:16.00},
      {cat:'Sucos',code:'236',name:'Morango (polpa)',price:16.00},
      {cat:'Sucos',code:'237',name:'Abacaxi (polpa)',price:16.00},

      // Lanche de LinguiÃ§a (146-152 + especial)
      {cat:'LinguiÃ§a',code:'146',name:'LinguiÃ§a, queijo e ovo',price:33.50},
      {cat:'LinguiÃ§a',code:'147',name:'LinguiÃ§a, queijo e tomate',price:33.50},
      {cat:'LinguiÃ§a',code:'148',name:'LinguiÃ§a, queijo e vinagrete',price:33.50},
      {cat:'LinguiÃ§a',code:'149',name:'LinguiÃ§a, queijo, ovo e cebola',price:38.50},
      {cat:'LinguiÃ§a',code:'150',name:'LinguiÃ§a, ovo e azeitona preta',price:38.50},
      {cat:'LinguiÃ§a',code:'151',name:'LinguiÃ§a, queijo, bacon, ovo e tomate',price:40.50},
      {cat:'LinguiÃ§a',code:'152',name:'LinguiÃ§a, queijo, bacon e salada',price:39.50},
      {cat:'LinguiÃ§a',name:'Especial de LinguiÃ§a',desc:'2 linguiÃ§as, queijo, presunto, ovo, bacon, cebola, azeitona preta e salada',price:33.00},

      // Lanche no Prato (161-166)
      {cat:'No Prato',code:'161',name:'Calabresa, queijo, presunto, bacon, azeitona preta, salada, ovo e fritas',price:55.00},
      {cat:'No Prato',code:'162',name:'FilÃ© mignon, queijo, presunto, bacon, azeitona preta, salada, ovo e fritas',price:62.00},
      {cat:'No Prato',code:'163',name:'Frango, queijo, presunto, bacon, azeitona preta, salada, ovo e fritas',price:59.00},
      {cat:'No Prato',code:'164',name:'2 hambÃºrgueres, queijo, presunto, bacon, azeitona preta, salada, ovo e fritas',price:57.00},
      {cat:'No Prato',code:'165',name:'LinguiÃ§a, queijo, presunto, bacon, azeitona preta, salada e fritas',price:57.00},
      {cat:'No Prato',code:'166',name:'Pernil, queijo, presunto, bacon, azeitona preta, salada, ovo e fritas',price:58.00},

      // Pernil suÃ­no (153-160)
      {cat:'Pernil',code:'153',name:'Pernil e queijo',price:31.00},
      {cat:'Pernil',code:'154',name:'Pernil, queijo e salada',price:32.00},
      {cat:'Pernil',code:'155',name:'Pernil, queijo e vinagrete',price:34.00},
      {cat:'Pernil',code:'156',name:'Pernil, queijo, bacon e salada',price:37.00},
      {cat:'Pernil',code:'157',name:'Pernil, queijo, presunto, azeitona preta, bacon e salada',price:43.00},
      {cat:'Pernil',code:'158',name:'Pernil, queijo, ovo, bacon e salada',price:40.00},
      {cat:'Pernil',code:'159',name:'Pernil, queijo, presunto, bacon, champignon e salada',price:43.00},
      {cat:'Pernil',code:'160',name:'Pernil, queijo, presunto, catupiry e salada',price:42.00},

      // PorÃ§Ãµes (211,216,217,212,213,215,219,221,222,223,224,225,226)
      {cat:'PorÃ§Ãµes',code:'211-meia',name:'Fritas (Meia)',price:26.00},
      {cat:'PorÃ§Ãµes',code:'211-inteira',name:'Fritas (Inteira)',price:33.50},
      {cat:'PorÃ§Ãµes',code:'216-meia',name:'Fritas c/ Mussarela (Meia)',price:32.75},
      {cat:'PorÃ§Ãµes',code:'216-inteira',name:'Fritas c/ Mussarela (Inteira)',price:42.50},
      {cat:'PorÃ§Ãµes',code:'217-meia',name:'Fritas c/ Bacon (Meia)',price:32.75},
      {cat:'PorÃ§Ãµes',code:'217-inteira',name:'Fritas c/ Bacon (Inteira)',price:42.50},
      {cat:'PorÃ§Ãµes',code:'212-meia',name:'Fritas c/ Cheddar (Meia)',price:32.75},
      {cat:'PorÃ§Ãµes',code:'212-inteira',name:'Fritas c/ Cheddar (Inteira)',price:42.75},
      {cat:'PorÃ§Ãµes',code:'213',name:'Fritas c/ Cheddar e Bacon',price:47.50},
      {cat:'PorÃ§Ãµes',code:'215',name:'Calabresa c/ Fritas',price:42.00},
      {cat:'PorÃ§Ãµes',code:'219-meia',name:'FilÃ© de TilÃ¡pia (Meia)',price:45.00},
      {cat:'PorÃ§Ãµes',code:'219-inteira',name:'FilÃ© de TilÃ¡pia (Inteira)',price:88.50},
      {cat:'PorÃ§Ãµes',code:'221-meia',name:'Mandioca (Meia)',price:26.00},
      {cat:'PorÃ§Ãµes',code:'221-inteira',name:'Mandioca (Inteira)',price:33.50},
      {cat:'PorÃ§Ãµes',code:'222-meia',name:'FilÃ© Mignon c/ Fritas (Meia)',price:60.50},
      {cat:'PorÃ§Ãµes',code:'222-inteira',name:'FilÃ© Mignon c/ Fritas (Inteira)',price:75.50},
      {cat:'PorÃ§Ãµes',code:'223-meia',name:'Contra FilÃ© c/ Fritas (Meia)',price:61.00},
      {cat:'PorÃ§Ãµes',code:'223-inteira',name:'Contra FilÃ© c/ Fritas (Inteira)',price:69.00},
      {cat:'PorÃ§Ãµes',code:'224-meia',name:'LinguiÃ§a c/ Fritas (Meia)',price:56.00},
      {cat:'PorÃ§Ãµes',code:'224-inteira',name:'LinguiÃ§a c/ Fritas (Inteira)',price:68.50},
      {cat:'PorÃ§Ãµes',code:'225-meia',name:'FilÃ© de Frango c/ Fritas (Meia)',price:56.50},
      {cat:'PorÃ§Ãµes',code:'225-inteira',name:'FilÃ© de Frango c/ Fritas (Inteira)',price:68.50},
      {cat:'PorÃ§Ãµes',code:'226',name:'Frango Ã  Passarinho (Inteira)',price:56.50},

      // Drinks / Sucos / Bebidas variadas (244-261 etc)
      {cat:'Drinks',code:'244',name:'Laranja c/ Abacaxi',price:18.00},
      {cat:'Drinks',code:'245',name:'Laranja c/ Acerola',price:18.00},
      {cat:'Drinks',code:'246',name:'Laranja c/ Cenoura',price:18.00},
      {cat:'Drinks',code:'248',name:'Laranja c/ Morango',price:18.00},
      {cat:'Drinks',code:'249',name:'Abacaxi c/ HortelÃ£',price:20.00},
      {cat:'Drinks',code:'250',name:'G.A.L. (GuaranÃ¡, Abacaxi & Leite Condensado)',price:20.00},
      {cat:'Drinks',code:'251',name:'Limonada SuÃ­Ã§a',price:20.00},
      {cat:'Drinks',code:'252',name:'Vitamina de Morango',price:20.00},
      {cat:'Drinks',code:'253',name:'Laracreme',price:25.00},
      {cat:'Drinks',code:'258',name:'Caipirinha (Pinga e sabores)',price:21.00},
      {cat:'Drinks',code:'259',name:'Vodka (sabores)',price:23.00},
      {cat:'Drinks',code:'260',name:'Dose de Campari',price:17.00},
      {cat:'Drinks',code:'261',name:'Dose de Martini',price:17.00},

      // Sobremesas (254-257)
      {cat:'Sobremesas',code:'254',name:'Milk-Shake',price:28.00},
      {cat:'Sobremesas',code:'255',name:'Sundae',price:28.00},
      {cat:'Sobremesas',code:'256',name:'Petit GÃ¢teau',price:28.00},
      {cat:'Sobremesas',code:'257',name:'Sonho de Valsa',price:4.00}
    ];

    // UTIL
    function money(v){ return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }

    // Toggle campo Troco Para
    function toggleTroco() {
        const paymentMethod = document.getElementById('paymentMethod').value;
        const trocoField = document.getElementById('trocoField');
        if (paymentMethod === 'Dinheiro') {
            trocoField.style.display = 'block';
            document.getElementById('trocoPara').setAttribute('required', 'required');
            document.getElementById('trocoPara').value = ''; // Limpa o campo
        } else {
            trocoField.style.display = 'none';
            document.getElementById('trocoPara').removeAttribute('required');
            document.getElementById('trocoPara').value = '';
        }
    }
    window.toggleTroco = toggleTroco;

    // Construir categorias Ãºnicas e fixas na ordem em que aparecem no array
    const cats = [];
    MENU.forEach(m => { if (!cats.includes(m.cat)) cats.push(m.cat); });

    // Renderizar abas de categorias
    const catsWrap = document.getElementById('cats');
    let activeCat = cats[0] || null;
    cats.forEach((c,i) => {
      const b = document.createElement('div');
      b.className = 'cat' + (i===0 ? ' active' : '');
      b.innerText = c;
      b.onclick = () => { activeCat = c; document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active')); b.classList.add('active'); render(); window.scrollTo({top:120,behavior:'smooth'}); };
      catsWrap.appendChild(b);
    });

    // Render items por categoria e busca
    const itemsWrap = document.getElementById('items');
    function render(){
      const q = document.getElementById('search').value.trim().toLowerCase();
      itemsWrap.innerHTML = '';
      MENU.filter(it => (it.cat === activeCat) && (q === '' || it.name.toLowerCase().includes(q) || (it.desc || '').toLowerCase().includes(q)))
      .forEach(it => {
        const el = document.createElement('div');
        el.className = 'card';
        const itemCodeForCart = it.code || it.name;
        el.innerHTML = `
          <div class="thumb">${it.code ? it.code : it.cat[0]}</div>
          <div class="info"><h3>${it.name}${it.code ? ' â€” #' + it.code : ''}</h3><p>${it.desc ? it.desc : ''}</p></div>
          <div class="actions"><div class="price">${money(it.price)}</div><button class="btn" onclick='addToCart("${(it.code||'').replace(/"/g,'')}", "${(it.name||'').replace(/"/g,'')}", ${it.price})'>Adicionar</button></div>
        `;
        itemsWrap.appendChild(el);
      });
      // se nÃ£o achou nada
      if (itemsWrap.children.length === 0) {
        const no = document.createElement('div'); no.style.color = 'var(--muted)'; no.style.padding = '12px'; no.innerText = 'Nenhum item encontrado nessa categoria com essa busca.';
        itemsWrap.appendChild(no);
      }
    }

    // Inicializa
    render();

    // CARRINHO
    let cart = [];
    function addToCart(code,name,price){
      const idx = cart.findIndex(i=>i.code===code && i.name===name); 
      if (idx >= 0) cart[idx].q += 1;
      else cart.push({code, name, price, q:1});
      updateCart();
    }
    function changeQty(idx,delta){
      cart[idx].q += delta;
      if (cart[idx].q <= 0) cart.splice(idx,1);
      updateCart();
    }
    
    let totalValue = 0; // VariÃ¡vel global para o valor total
    function updateCart(){
      const wrap = document.getElementById('cartList');
      wrap.innerHTML = '';
      if (cart.length === 0) {
        wrap.innerHTML = '<div style="color:var(--muted)">Carrinho vazio â€” adicione algo gostoso!</div>';
        document.getElementById('totalPrice').innerText = money(0);
        document.getElementById('whatsBtn').disabled = true;
        return;
      }
      totalValue = 0; // Zera o total
      cart.forEach((it, idx) => {
        totalValue += it.price * it.q;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <div style="flex:1">
            <strong>${it.q}x ${it.name}</strong>
            <div style="font-size:12px;color:var(--muted)">R$ ${it.price.toFixed(2)} cada</div>
          </div>
          <div class="qty">
            <button onclick="changeQty(${idx},-1)">-</button>
            <div style="min-width:28px;text-align:center">${it.q}</div>
            <button onclick="changeQty(${idx},1)">+</button>
          </div>
        `;
        wrap.appendChild(div);
      });
      document.getElementById('totalPrice').innerText = money(totalValue);
      document.getElementById('whatsBtn').disabled = false;
    }

    // VALIDAÃ‡ÃƒO E ENVIO FINAL
    function validateAndSendToWhatsApp(){
        if (cart.length === 0) {
            alert("Seu carrinho estÃ¡ vazio! Adicione itens antes de finalizar o pedido.");
            return;
        }

        const form = document.getElementById('checkoutForm');
        // Checagem bÃ¡sica de validaÃ§Ã£o (para os campos 'required' do HTML5)
        if (!form.reportValidity()) {
            return;
        }

        const paymentMethod = document.getElementById('paymentMethod').value;
        const trocoPara = document.getElementById('trocoPara').value;

        // ValidaÃ§Ã£o especÃ­fica para o campo 'Troco Para'
        if (paymentMethod === 'Dinheiro' && totalValue > 0) {
             const troco = parseFloat(trocoPara);
             if (isNaN(troco) || troco < totalValue) {
                alert(`Para pagamento em Dinheiro, o campo "Troco para quanto?" deve ser maior ou igual ao total do pedido (${money(totalValue)}).`);
                document.getElementById('trocoPara').focus();
                return;
             }
        }
        
        // Se a validaÃ§Ã£o passar, gera a mensagem e redireciona
        generateWhatsAppMessage(totalValue, paymentMethod, trocoPara);
    }
    
    function generateWhatsAppMessage(total, payment, troco) {
        
        // ObtÃ©m o ID sequencial persistente
        const currentOrderID = getNextOrderID();

        const name = document.getElementById('clientName').value;
        const address = document.getElementById('clientAddress').value;
        const number = document.getElementById('clientNumber').value;
        const cep = document.getElementById('clientCEP').value;
        const phone = document.getElementById('clientPhone').value;
        const ref = document.getElementById('clientRef').value;
        
        let trocoInfo = '';
        if (payment === 'Dinheiro' && troco) {
            trocoInfo = `\nTroco Para: ${money(parseFloat(troco))}`;
        } else if (payment === 'Dinheiro') {
             trocoInfo = '\nTroco Para: NÃ£o Precisa de Troco';
        }

        // ALTERAÃ‡ÃƒO AQUI: Usa apenas o cÃ³digo (ou nome, se nÃ£o houver cÃ³digo) como identificador
        const lines = cart.map(i => {
            // Se i.code existe, usa (#CODE). Se nÃ£o existe, usa o i.name (e.g. 'Cebola')
            const itemIdentifier = i.code ? `(#${i.code})` : i.name;
            return `*${i.q}x* ${itemIdentifier} - ${money(i.price*i.q)}`;
        });

        // Formato da Mensagem (NÃºmero do Pedido Sequencial apÃ³s #)
        const orderText = `*PEDIDO #${currentOrderID} - Katraka Lanches*
        
*========================*
*ITENS DO PEDIDO:*
${lines.join('\n')}
*========================*
*TOTAL:* ${money(total)}
*========================*

*DADOS DO CLIENTE:*
Nome: ${name}
Telefone: ${phone}

*DADOS DA ENTREGA:*
CEP: ${cep}
EndereÃ§o: ${address}, NÂº ${number}
ReferÃªncia: ${ref || 'NÃ£o informada'}

*PAGAMENTO:*
Forma: ${payment}${trocoInfo}`;

        const text = encodeURIComponent(orderText.trim());
        window.open(`https://wa.me/${PHONE_NUMBER}?text=${text}`, '_blank');
    }

    
    document.getElementById('year').innerText = new Date().getFullYear();

    
    window.addToCart = addToCart;
    window.changeQty = changeQty;
    window.render = render;
    window.updateCart = updateCart;
    window.validateAndSendToWhatsApp = validateAndSendToWhatsApp;
  </script>
</body>
</html>